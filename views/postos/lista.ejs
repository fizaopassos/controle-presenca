<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Postos - Controle de Presença</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
    rel="stylesheet"
  >
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="/dashboard">Controle de Presença</a>
      <div class="d-flex">
        <span class="navbar-text text-white me-3">
          Olá, <%= usuario.nome %> (<%= usuario.perfil %>)
        </span>
        <a href="/auth/logout" class="btn btn-outline-light btn-sm">Sair</a>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h4 mb-0">Postos de Trabalho</h1>

      <!-- Botão Novo Posto via HTMX + Modal -->
      <button
        type="button"
        class="btn btn-primary"
        hx-get="/postos/novo?partial=1"
        hx-target="#postoModalBody"
        hx-swap="innerHTML"
      >
        + Novo Posto
      </button>
    </div>

    <table class="table table-striped table-hover">
<thead>
<tr>
<th>ID</th>
<th>Nome do Posto</th>
<th>Descrição</th>
<th>Ativo</th>
<th style="width: 200px;">Ações</th>
</tr>
</thead>

<tbody id="tabelaPostos">
<% if (postos.length === 0) { %>
<tr id="linhaVaziaPostos">
<td colspan="5" class="text-center text-muted py-4">
Nenhum posto cadastrado ainda.
</td>
</tr>
<% } else { %>
<% postos.forEach(p => { %>
<%- include('_linha', { p: p }) %>
<% }) %>
<% } %>
</tbody>
</table>
  </div>

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Scripts para abrir/fechar modal com HTMX -->
  <script>
    // Abrir modal quando o conteúdo do formulário for carregado via HTMX
    document.body.addEventListener('htmx:afterSwap', function (evt) {
      if (evt.target && evt.target.id === 'postoModalBody') {
        const modalEl = document.getElementById('postoModal');
        const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
        modal.show();
      }
    });

    // Fechar modal após salvar com sucesso (novo ou editar)
    document.body.addEventListener('htmx:afterRequest', function(evt) {
      if (evt.detail.elt && evt.detail.elt.id === 'formPostoHtmx' && evt.detail.successful) {
        const modalEl = document.getElementById('postoModal');
        const modal = bootstrap.Modal.getInstance(modalEl);
        if (modal) {
          modal.hide();
        }
      }
    });
  </script>

  <!-- Modal para criar/editar Posto via HTMX -->
  <div class="modal fade" id="postoModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Posto</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="postoModalBody"></div>
      </div>
    </div>
  </div>

</body>
</html>
