<%
const _isModal = (typeof isModal === 'undefined') ? false : isModal;
const inputSize = _isModal ? '' : 'form-control-lg';
const groupSize = _isModal ? '' : 'input-group-lg';
%>

<div class="container my-4 fade-in">

<div class="page-header d-flex justify-content-between align-items-start flex-wrap gap-2 mb-4">
<div>
<h1 class="h3 mb-1">
<i class="bi <%= isNovo ? 'bi-plus-circle' : 'bi-pencil-square' %> text-primary me-2"></i>
<%= isNovo ? 'Nova Empresa' : 'Editar Empresa' %>
</h1>
<p class="subtitle mb-0">
<%= isNovo ? 'Cadastre uma nova empresa fornecedora' : 'Atualize as informações da empresa' %>
</p>
</div>

<a href="/empresas" class="btn btn-outline-secondary">
  <i class="bi bi-arrow-left me-1"></i>
  Voltar
</a>

</div>

<div class="card">
<div class="card-header">
<i class="bi bi-building me-2"></i>
Dados da Empresa
</div>

<div class="card-body p-4">
  <form
    action="<%= isNovo ? '/empresas/novo' : '/empresas/editar/' + empresa.id %>"
    method="POST"
    class="row g-4"
    id="formEmpresa"
  >

    <div class="col-md-8">
      <label for="nome" class="form-label">
        <i class="bi bi-building text-primary me-1"></i>
        Nome da Empresa *
      </label>
      <input
        type="text"
        class="form-control form-control-lg"
        id="nome"
        name="nome"
        placeholder="Ex: Empresa de Segurança XYZ Ltda"
        required
        value="<%= (empresa && empresa.nome) ? empresa.nome : '' %>"
        autofocus
      >
      <div class="form-text">
        <i class="bi bi-info-circle me-1"></i>
        Nome completo ou razão social da empresa
      </div>
    </div>

    <div class="col-md-4">
      <label for="cnpj" class="form-label">
        <i class="bi bi-file-text text-primary me-1"></i>
        CNPJ
      </label>
      <input
        type="text"
        class="form-control form-control-lg"
        id="cnpj"
        name="cnpj"
        placeholder="00.000.000/0000-00"
        value="<%= (empresa && empresa.cnpj) ? empresa.cnpj : '' %>"
        maxlength="18"
      >
      <div class="form-text">Opcional</div>
    </div>

    <div class="col-md-4">
      <label for="telefone" class="form-label">
        <i class="bi bi-telephone text-primary me-1"></i>
        Telefone
      </label>
      <div class="input-group input-group-lg">
        <span class="input-group-text">
          <i class="bi bi-telephone"></i>
        </span>
        <input
          type="text"
          class="form-control"
          id="telefone"
          name="telefone"
          placeholder="(00) 0000-0000"
          value="<%= (empresa && empresa.telefone) ? empresa.telefone : '' %>"
        >
      </div>
    </div>

    <div class="col-md-8">
      <label for="email" class="form-label">
        <i class="bi bi-envelope text-primary me-1"></i>
        Email
      </label>
      <div class="input-group input-group-lg">
        <span class="input-group-text">
          <i class="bi bi-envelope"></i>
        </span>
        <input
          type="email"
          class="form-control"
          id="email"
          name="email"
          placeholder="contato@empresa.com.br"
          value="<%= (empresa && empresa.email) ? empresa.email : '' %>"
        >
      </div>
    </div>

    <div class="col-12">
      <label for="endereco" class="form-label">
        <i class="bi bi-geo-alt text-primary me-1"></i>
        Endereço Completo
      </label>
      <textarea
        class="form-control"
        id="endereco"
        name="endereco"
        rows="2"
        placeholder="Rua, Número, Bairro, Cidade - Estado"
      ><%= (empresa && empresa.endereco) ? empresa.endereco : '' %></textarea>
    </div>

    <% if (!isNovo) { %>
      <div class="col-12">
        <div class="card bg-light">
          <div class="card-body">
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                role="switch"
                id="ativo"
                name="ativo"
                <%= (empresa && empresa.ativo) ? 'checked' : '' %>
              >
              <label class="form-check-label fw-semibold" for="ativo">
                <i class="bi bi-toggle-on text-success me-1"></i>
                Empresa Ativa
              </label>
              <div class="form-text">
                Empresas inativas não aparecem em novos cadastros
              </div>
            </div>
          </div>
        </div>
      </div>
    <% } %>

    <div class="col-12">
      <hr class="my-2">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
        <a href="/empresas" class="btn btn-outline-secondary">
          <i class="bi bi-x-circle me-1"></i>
          Cancelar
        </a>
        <button type="submit" class="btn btn-primary btn-lg px-5" id="btnSalvar">
          <i class="bi bi-check-circle me-2"></i>
          Salvar Empresa
        </button>
      </div>
    </div>

  </form>
</div>

</div>

<div class="card mt-3 border-primary">
<div class="card-body">
<h6 class="card-title">
<i class="bi bi-lightbulb text-warning me-2"></i>
Dica
</h6>
<p class="card-text small mb-0">
Cadastre todas as empresas prestadoras de serviço.
Depois você poderá vincular colaboradores a essas empresas.
</p>
</div>
</div>

</div>

<script>
// Máscara de CNPJ
const cnpjInput = document.getElementById('cnpj');
if (cnpjInput) {
cnpjInput.addEventListener('input', function(e) {
let value = e.target.value.replace(/\D/g, '');
if (value.length <= 14) {
value = value.replace(/^(\d{2})(\d)/, '$1.$2');
value = value.replace(/^(\d{2}).(\d{3})(\d)/, '$1.$2.$3');
value = value.replace(/.(\d{3})(\d)/, '.$1/$2');
value = value.replace(/(\d{4})(\d)/, '$1-$2');
}
e.target.value = value;
});
}

// Máscara de Telefone
const telefoneInput = document.getElementById('telefone');
if (telefoneInput) {
telefoneInput.addEventListener('input', function(e) {
let value = e.target.value.replace(/\D/g, '');
if (value.length <= 11) {
if (value.length <= 10) {
value = value.replace(/^(\d{2})(\d)/, '($1) $2');
value = value.replace(/(\d{4})(\d)/, '$1-$2');
} else {
value = value.replace(/^(\d{2})(\d)/, '($1) $2');
value = value.replace(/(\d{5})(\d)/, '$1-$2');
}
}
e.target.value = value;
});
}

// Loading state no botão
const form = document.getElementById('formEmpresa');
const btnSalvar = document.getElementById('btnSalvar');

if (form && btnSalvar) {
form.addEventListener('submit', function() {
btnSalvar.disabled = true;
btnSalvar.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Salvando...';
});
}
</script>