<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Colaboradores - Controle de Presença</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link
href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
rel="stylesheet"

<link rel="stylesheet" href="/css/style.css">
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
<div class="container-fluid">
<a class="navbar-brand" href="/dashboard">Controle de Presença</a>
<div class="d-flex">
<span class="navbar-text text-white me-3">
Olá, <%= usuario.nome %> (<%= usuario.perfil %>)
</span>
<a href="/auth/logout" class="btn btn-outline-light btn-sm">Sair</a>
</div>
</div>
</nav>

<div class="container mt-4">
<div class="d-flex justify-content-between align-items-center mb-3">
<h1 class="h4 mb-0">Colaboradores</h1>

  <!-- Botão Novo Colaborador via HTMX + Modal -->
  <button
    type="button"
    class="btn btn-primary"
    hx-get="/colaboradores/novo?partial=1"
    hx-target="#colaboradorModalBody"
    hx-swap="innerHTML"
  >
    Novo colaborador
  </button>
</div>

<table class="table table-striped table-hover">
<thead>
<tr>
<th>ID</th>
<th>Nome</th>
<th>Empresa</th>
<th>Condomínio</th>
<th>Posto</th>
<th>Tipo</th>
<th>Ativo</th>
<th style="width: 200px;">Ações</th>
</tr>
</thead>

<tbody id="tabelaColaboradores">
<% if (colaboradores.length === 0) { %>
<tr id="linhaVaziaColaboradores">
<td colspan="8" class="text-center text-muted py-4">
Nenhum colaborador cadastrado ainda.
</td>
</tr>
<% } else { %>
<% colaboradores.forEach(c => { %>
<%- include('_linha', { c: c }) %>
<% }) %>
<% } %>
</tbody>
</table>

</div>

<!-- HTMX -->
<script src="https://unpkg.com/htmx.org@1.9.12"></script>
<!-- Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Scripts para abrir/fechar modal com HTMX -->
<script>
// Abrir modal quando o conteúdo do formulário for carregado via HTMX
document.body.addEventListener('htmx:afterSwap', function (evt) {
if (evt.target && evt.target.id === 'colaboradorModalBody') {
const modalEl = document.getElementById('colaboradorModal');
const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
modal.show();
}
});

// Fechar modal após salvar com sucesso (novo ou editar)
document.body.addEventListener('htmx:afterRequest', function(evt) {
  var el = evt.detail && evt.detail.elt ? evt.detail.elt : null;
  if (!el || !evt.detail.successful) return;

  if (el.id === 'formColaboradorHtmx') {
    const modalEl = document.getElementById('colaboradorModal');
    const modal = bootstrap.Modal.getInstance(modalEl);
    if (modal) modal.hide();
  }
});

</script>

<!-- Modal para criar/editar Colaborador via HTMX -->
<div class="modal fade" id="colaboradorModal" tabindex="-1">
<div class="modal-dialog modal-lg modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Colaborador</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body" id="colaboradorModalBody"></div>
</div>
</div>
</div>

</body>
</html>