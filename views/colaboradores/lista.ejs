<div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
<div>
<h4 class="page-title mb-1">
<i class="bi bi-people text-primary me-2"></i>
Colaboradores
</h4>
<p class="text-muted mb-0">
Gerencie os colaboradores vinculados às empresas, condomínios e postos.
</p>
</div>

<button
type="button"
class="btn btn-primary"
hx-get="/colaboradores/novo?partial=1"
hx-target="#colaboradorModalBody"
hx-swap="innerHTML">
<i class="bi bi-plus-circle me-1"></i>
Novo colaborador
</button>
</div>

<div class="card">
<div class="card-body">
<% if (colaboradores.length === 0) { %>
<p class="text-muted mb-0">
Nenhum colaborador cadastrado ainda.
</p>
<% } else { %>
<div class="table-responsive">
<table class="table align-middle">
<thead>
<tr>
<th>ID</th>
<th>Nome</th>
<th>Empresa</th>
<th>Condomínio</th>
<th>Posto</th>
<th>Tipo</th>
<th>Status</th>
<th class="text-end" style="width: 220px;">Ações</th>
</tr>
</thead>
<tbody id="tabelaColaboradores">
<% colaboradores.forEach(c => { %>
<%- include('_linha', { c: c }) %>
<% }) %>
</tbody>
</table>
</div>
<% } %>
</div>
</div>


<script>
// Abrir modal quando o conteúdo do formulário for carregado via HTMX
document.body.addEventListener('htmx:afterSwap', function (evt) {
if (evt.target && evt.target.id === 'colaboradorModalBody') {
const modalEl = document.getElementById('colaboradorModal');
const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
modal.show();
}
});

// Fechar modal após salvar com sucesso (novo ou editar)
document.body.addEventListener('htmx:afterRequest', function(evt) {
  const el = evt.detail && evt.detail.elt ? evt.detail.elt : null;
  if (!el || !evt.detail.successful) return;

  // Verifica se o elemento disparador é o botão de salvar dentro do form de colaborador
  const form = el.closest('#formColaboradorHtmx');
  if (form) {
    const modalEl = document.getElementById('colaboradorModal');
    const modal = bootstrap.Modal.getInstance(modalEl);
    if (modal) modal.hide();
  }
});

</script>

<!-- Modal para criar/editar Colaborador via HTMX -->
<div class="modal fade" id="colaboradorModal" tabindex="-1">
<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Colaborador</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body" id="colaboradorModalBody"></div>
</div>
</div>
</div>